---
title: Docker
description: <center> Docker - 1 </center>
categories:
 - Doker
tags:
---

## docker 등장 배경
로컬에 있는 경로와 서버에 있는 경로, 그리고 서버의 운영체제와 로컬의 운영체제는 다르다 매번 같은 환경을 맞춰 줄 수 없기 떄문에 Docker가 등장하게 되었다.

## virtualenv

virtualenv가 주는 이점: 가상환경을 각자 나누어 놓아서 requirments만 설치하게 되면 누구든 같은 환경을 구성할 수 있다.

## docker
운영체제를 감싸는 것이다.(가상운영체제) 만약에 우분투를 사용한다 하면 우분투 16.04를 기준으로 로컬에서 작업을 하고 서버에 올리면 서버에서는 어떤 운영체제가 있어도 우리가 올린 가상운영체제를 바탕으로 돌아가게 만든다. docker는 운영체제 단위로 감싸고 있음에도 불구하고 성능에 손실이 거의 없다.

마이크로서비스 아키텍쳐가 유행하면서 프로그램은 점점 잘게 쪼개져서 관리되고 새로운 기능은 쏟아져 나오기 때문에 관리해야할 서버가 무한대로 늘어나게 된다. 이런 상황을 해결하기 위해 docker가 등장하게 된 것 이다.

## 운영체제 버전
운영체제 버전을 올리는 순간 전버전에서 구현했던 기능들은 무용지물이 된다. 그렇기 때문에 예전엔 버전을 업데이트 하는건 엄청난 리스크였고 그대로 두는게 최선의 방법이였다.

## 컨테이너
프로그램 실행환경을 컨테이너로 추상화 한다. 우리가 만든 운영체제 자체를 하나의 컨테이너로 만든다. 하나의 컨테이너의 우리가 만든 명령체제를 그대로 띄우고 그안에서 작업들을 할 수 있게 한다. 같은 환경에 대해서는 여러개의 컨테이너를 만들 수 있다. 한 컴퓨터 안에서 여러개의 컨테이너를 띄울 수 있다. 또는 하나의 환경이 있으면 그걸 가지고 여러 서버에 컨테이너를 띄울 수 있다.


## 프로세스 격리
우리가 돌리는 프로세스들을 다른영역에서 실행한다. 즉 칸만 나눴다 라고 생각하면 된다.(만들기 굉장히 어렵다.) 리눅스에 원래 구현되어 있던 방식이다. 그렇기 때문에 docker로 사용하는 컨테이너 형태의 프로세스 격리방식은 리눅스에서만 가능하다. 그렇기 때문에 mac에서는 docker를 돌리기 위해 vm을 이용하여 돌린다. 그렇기 떄문에 mac에서 docker를 기반으로 개발을 하게 되면 굉장히 느리다. (리눅스에서는 빠르게 작동한다.)

## 이미지
이미지는 환경을 말한다. mysql이라는 이미지가 있다고하자 그렇다면 mysql이미지를 포함시키면 mysql을 실행 시킬 수 있다. 어떤 이미지를 만드는데 mysql이미지와 wordpress이미지 가져와서 합친후 둘을 적절히 융합시키는 코드를 짜주고 이 이미지를 실행시키면 하나의 컨테이너가 나오게 된다.

이미지는 그 이미지를 이용해서 만든 컨테이너 안에서 상태를 변화시키는 것은 가능하지만 이미지 자체는 변하지 않는다. 추가 되거나 변하는 값은 컨테이너에 저장되고 우리가 만약 컨테이너를 지워버리면 지금까지의 저장 내역은 전부다 사라진다.

ubuntu이미지는 ubuntu를 실행하기 위한 모든 파일을 가지고 있고 mysql은 debian기반으로 mysql을 실행하는데 필요한 파일을 가지고 있다. linux로 개발을 한다라고 하면 ubuntu를 쓰지만 linux로 운영을 한다 하면 debian을 쓴다.

## 레이어 저장방식
우리가 ubuntu에 nginx를 올린다면 이미지들이 따로 존재하는게 아니다. 이미지를 만들기 위해서 레이어가 존재하는데 ubuntu를 만들때 3번의 과정을 거쳐 3개의 레이어가 존재하는데, 그 위에 nginx를 올려서 새로운 이미지를 만들면 ubuntu이미지와 nginx이미지는 3개의 레이어를 공유하게 된다. 그렇기 때문에 이미지가 2개 존재해도 용량에 손실이 없다. 마찬가지로 django소스가 포함 되더라도 추가되는 용량은 django소스 뿐이다.

## Dockerfile 
우리가 만든 deploy.sh파일과 같다. docker이미지를 만들어준다. 어떤 이미지로부터 시작해서 어떤 명령어를 거친 다음에 프로그램을 실행한다던가 외부 포트를 개방한다던가 하는 명령들을 넣어 놓는다. 나중에 dockerfile만 봐도 어떤식으로 만들어 지겠구나 하는 감이 오게 된다. ubuntu버전 등 무엇을 실행하기 위해 존재하는지 알 수 있다. 